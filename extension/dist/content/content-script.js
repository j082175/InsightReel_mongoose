(()=>{class t{static detectPlatform(){const t=window.location.hostname;return t.includes("instagram.com")?"INSTAGRAM":t.includes("tiktok.com")?"TIKTOK":t.includes("youtube.com")||t.includes("youtu.be")?"YOUTUBE":null}static log(t,n,e=null){const o=`[InsightReel ${(new Date).toISOString()}]`;switch(t){case"info":console.log(`${o} ℹ️ ${n}`,e||"");break;case"warn":console.warn(`${o} ⚠️ ${n}`,e||"");break;case"error":console.error(`${o} ❌ ${n}`,e||"");break;case"success":console.log(`${o} ✅ ${n}`,e||"");break;default:console.log(`${o} ${n}`,e||"")}}}const n={SERVER_URL:"http://localhost:3000",NODE_ENV:"production",GOOGLE_API_KEY:null,isDevelopment:!1},e={INSTAGRAM:"INSTAGRAM",TIKTOK:"TIKTOK",YOUTUBE:"YOUTUBE"};class o{constructor(t=n.SERVER_URL){this.serverUrl=t}async checkConnection(){try{return(await fetch(`${this.serverUrl}/health`,{method:"GET",timeout:5e3})).ok}catch(n){return t.log("error","Server connection failed",n),!1}}}class i{constructor(){this.processedElements=new Set}cleanup(){}}class a{constructor(){this.platform=t.detectPlatform(),this.apiClient=new o,this.uiManager=new i,this.platformHandler=null,this.init()}init(){t.log("info","InsightReel Content Script 시작",{platform:this.platform,url:window.location.href,environment:n.NODE_ENV}),this.platform?(this.checkServerConnection(),this.setupMessageListeners(),this.validateEnvironment(),this.initializePlatformHandler()):t.log("warn","지원되지 않는 플랫폼",window.location.hostname)}initializePlatformHandler(){try{switch(this.platform){case e.INSTAGRAM:this.initializeInstagram(),t.log("success","✅ Instagram 기능 초기화 완료");break;case e.YOUTUBE:this.initializeYouTube(),t.log("success","✅ YouTube 기능 초기화 완료");break;case e.TIKTOK:this.initializeTikTok(),t.log("success","✅ TikTok 기능 초기화 완료");break;default:return void t.log("warn","알 수 없는 플랫폼",this.platform)}window.addEventListener("beforeunload",()=>{this.cleanup()}),t.log("success",`🎯 ${this.platform} 플랫폼 기능 초기화 완료`)}catch(n){t.log("error","플랫폼 핸들러 초기화 실패",n),this.initializeBasicFeatures()}}initializeBasicFeatures(){setInterval(()=>{this.addBasicButtons()},2e3),t.log("info","기본 기능으로 폴백")}initializeInstagram(){setInterval(()=>{this.addInstagramAnalysisButtons()},1500)}initializeYouTube(){this.addYouTubeButtons(),window.addEventListener("yt-navigate-finish",()=>{setTimeout(()=>this.addYouTubeButtons(),500)})}initializeTikTok(){setInterval(()=>{this.addTikTokAnalysisButtons()},2e3)}addInstagramAnalysisButtons(){document.querySelectorAll('article[role="presentation"]').forEach(t=>{if(t.querySelector(".instagram-analysis-button"))return;if(!t.querySelector("video"))return;const n=this.createAnalysisButton("instagram","🤖 분석");n.className="instagram-analysis-button",n.style.cssText="\n                background: linear-gradient(45deg, #8e44ad, #3498db) !important;\n                color: white !important;\n                border: none !important;\n                border-radius: 20px !important;\n                padding: 8px 16px !important;\n                font-size: 12px !important;\n                cursor: pointer !important;\n                margin: 5px !important;\n                z-index: 9999 !important;\n                position: relative !important;\n            ";const e=t.querySelectorAll('svg[aria-label*="저장"], svg[aria-label*="Save"]');if(e.length>0){const t=e[0].closest("button");t&&t.parentElement&&t.parentElement.appendChild(n)}})}addYouTubeButtons(){const t="/watch"===window.location.pathname,n=window.location.pathname.startsWith("/shorts/"),e=window.location.pathname.includes("/channel/")||window.location.pathname.includes("/@");t?this.addYouTubeVideoAnalysisButton():n?this.addYouTubeShortsAnalysisButton():e&&this.addYouTubeChannelAnalysisButton()}addYouTubeVideoAnalysisButton(){if(document.querySelector(".youtube-analysis-button"))return;const t=document.querySelector("#top-level-buttons-computed")||document.querySelector("#actions #top-level-buttons");if(t){const n=this.createAnalysisButton("youtube","🎬 영상 분석");n.className="youtube-analysis-button",n.style.cssText="\n                background: #ff0000 !important;\n                color: white !important;\n                border: none !important;\n                border-radius: 18px !important;\n                padding: 10px 16px !important;\n                font-size: 14px !important;\n                font-weight: 500 !important;\n                cursor: pointer !important;\n                margin-left: 8px !important;\n                height: 36px !important;\n            ",t.appendChild(n)}}addYouTubeShortsAnalysisButton(){if(document.querySelector(".youtube-shorts-analysis-button"))return;const t=document.querySelector("#actions");if(t){const n=this.createAnalysisButton("youtube-shorts","📱 Shorts 분석");n.className="youtube-shorts-analysis-button",n.style.cssText="\n                background: rgba(0, 0, 0, 0.8) !important;\n                color: white !important;\n                border: 1px solid rgba(255, 255, 255, 0.3) !important;\n                border-radius: 24px !important;\n                width: 48px !important;\n                height: 48px !important;\n                font-size: 16px !important;\n                cursor: pointer !important;\n                margin: 8px 0 !important;\n                display: flex !important;\n                align-items: center !important;\n                justify-content: center !important;\n            ",t.appendChild(n)}}addYouTubeChannelAnalysisButton(){if(document.querySelector(".youtube-channel-analysis-button"))return;const t=document.querySelector("#channel-header")||document.querySelector("#channel-info");if(t){const n=this.createAnalysisButton("youtube-channel","🤖 채널 분석");n.className="youtube-channel-analysis-button",n.style.cssText="\n                background: linear-gradient(45deg, #ff6b6b, #ee5a24) !important;\n                color: white !important;\n                border: none !important;\n                border-radius: 20px !important;\n                padding: 12px 20px !important;\n                font-size: 14px !important;\n                font-weight: bold !important;\n                cursor: pointer !important;\n                margin: 10px !important;\n                box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;\n            ",t.appendChild(n)}}addTikTokAnalysisButtons(){document.querySelectorAll('div[data-e2e="recommend-list-item"]').forEach(t=>{if(t.querySelector(".tiktok-analysis-button"))return;const n=this.createAnalysisButton("tiktok","🎵 분석");n.className="tiktok-analysis-button",n.style.cssText="\n                background: #fe2c55 !important;\n                color: white !important;\n                border: none !important;\n                border-radius: 16px !important;\n                padding: 8px 12px !important;\n                font-size: 12px !important;\n                cursor: pointer !important;\n                position: absolute !important;\n                top: 10px !important;\n                right: 10px !important;\n                z-index: 9999 !important;\n            ",t.style.position="relative",t.appendChild(n)})}addBasicButtons(){document.querySelectorAll("video").forEach(t=>{const n=t.closest("article, div");if(!n||n.querySelector(".basic-insightreel-button"))return;const e=this.createAnalysisButton("basic","📥 저장");e.className="basic-insightreel-button",n.appendChild(e)})}createAnalysisButton(t,n){const e=document.createElement("button");return e.textContent=n,e.title=`InsightReel - ${t} 콘텐츠 분석`,e.addEventListener("click",()=>{this.handleAnalysisClick(t)}),e}async handleAnalysisClick(e){t.log("info",`🎯 ${e} 분석 버튼 클릭됨`);const o={platform:e.toUpperCase(),url:window.location.href,timestamp:(new Date).toISOString()};try{const e=await fetch(`${n.SERVER_URL}/api/process-video`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});e.ok?t.log("success","서버로 데이터 전송 완료"):t.log("warn","서버 응답 오류",e.status)}catch(n){t.log("error","서버 전송 실패",n.message)}}cleanup(){t.log("info","Content Script 정리 완료")}async checkServerConnection(){try{(await fetch(`${n.SERVER_URL}/health`,{method:"GET",timeout:5e3})).ok?t.log("success","서버 연결 확인됨"):t.log("warn","서버 연결 실패 - 기본 모드로 실행")}catch(n){t.log("error","서버 연결 확인 중 오류",n)}}setupMessageListeners(){chrome.runtime.onMessage.addListener((t,n,e)=>(this.handleMessage(t,n,e),!0))}async handleMessage(e,o,i){try{switch(e.action){case"ping":i({success:!0,message:"Content Script 응답"});break;case"getStatus":i({success:!0,data:{platform:this.platform,serverUrl:n.SERVER_URL,environment:n.NODE_ENV,hasHandler:!!this.platformHandler}});break;default:i({error:"알 수 없는 액션입니다."})}}catch(n){t.log("error","메시지 처리 실패",n.message),i({error:n.message})}}validateEnvironment(){t.log("info","환경 설정 확인",{serverUrl:n.SERVER_URL,nodeEnv:n.NODE_ENV,hasApiKey:!!n.GOOGLE_API_KEY,isDevelopment:n.isDevelopment}),n.GOOGLE_API_KEY||t.log("warn","GOOGLE_API_KEY 환경변수가 설정되지 않았습니다.")}}try{t.log("info","🚀 InsightReel Content Script 초기화 시작");const o=new a;window.INSIGHTREEL={contentScript:o,utils:t,platforms:e,environment:n},n.isDevelopment&&(window.ContentScript=o,window.Utils=t,window.PLATFORMS=e,window.environment=n,t.log("info","🛠️ 개발 모드: 디버깅 객체들이 window에 등록됨")),t.log("success","✅ InsightReel Content Script 초기화 완료")}catch(t){console.error("❌ InsightReel Content Script 실행 오류:",t),console.error("오류 위치:",t.stack),window.INSIGHTREEL_ERROR={error:t.message,stack:t.stack,timestamp:(new Date).toISOString()}}})();