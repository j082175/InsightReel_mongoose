(()=>{class e{constructor(){this.serverUrl="http://localhost:3000",this.init()}async init(){console.log("ðŸš€ íŒì—… ì´ˆê¸°í™” ì‹œìž‘"),"loading"===document.readyState&&await new Promise(e=>document.addEventListener("DOMContentLoaded",e));const e=document.getElementById("syncInstagramCookies");console.log("ðŸª Instagram ì¿ í‚¤ ë²„íŠ¼ ì°¾ìŒ:",!!e),await this.loadSettings(),this.setupEventListeners(),await Promise.all([this.checkServerStatus(),this.loadStats()]),console.log("ðŸ“‹ íŒì—… ì´ˆê¸°í™” ì™„ë£Œ")}async checkServerStatus(){const e=document.getElementById("status"),t=document.getElementById("statusText");try{if(!(await fetch(`${this.serverUrl}/health`)).ok)throw new Error("ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜");e.className="status connected",t.textContent="âœ… ì„œë²„ ì—°ê²°ë¨"}catch(n){e.className="status error",t.textContent="âŒ ì„œë²„ ì—°ê²° ì•ˆë¨ (ë¡œì»¬ ì„œë²„ë¥¼ ì‹œìž‘í•´ì£¼ì„¸ìš”)"}}async loadStats(){try{const e=await fetch(`${this.serverUrl}/api/stats`);if(e.ok){const t=await e.json();document.getElementById("totalVideos").textContent=t.total||0,document.getElementById("todayVideos").textContent=t.today||0}}catch(e){console.log("í†µê³„ ë¡œë“œ ì‹¤íŒ¨:",e)}}setupEventListeners(){this.debounceTimers={};const e=document.getElementById("syncInstagramCookies");console.log("ðŸ” Instagram ì¿ í‚¤ ë²„íŠ¼ ì°¾ê¸°:",!!e),e?(e.addEventListener("click",async()=>{console.log("ðŸª Instagram ì¿ í‚¤ ë™ê¸°í™” ë²„íŠ¼ í´ë¦­ë¨");const e=document.getElementById("syncInstagramCookies"),t=e.textContent;try{console.log("ðŸš€ ì„œë¹„ìŠ¤ ì›Œì»¤ë¡œ ì¿ í‚¤ ë™ê¸°í™” ìš”ì²­"),e.disabled=!0,e.textContent="â³ ì¿ í‚¤ ì²˜ë¦¬ ì¤‘...";const n=await chrome.runtime.sendMessage({action:"syncInstagramCookies"});if(console.log("ðŸ“¬ ì„œë¹„ìŠ¤ ì›Œì»¤ ì‘ë‹µ:",n),!n.success)throw new Error(n.error||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜");console.log("âœ… ì¿ í‚¤ ë™ê¸°í™” ì„±ê³µ"),e.textContent="âœ… ë™ê¸°í™” ì™„ë£Œ!",e.style.background="linear-gradient(135deg, #4CAF50 0%, #45a049 100%)",n.cookieCount&&(e.textContent=`âœ… ì™„ë£Œ (${n.cookieCount}ê°œ ì¿ í‚¤)`),setTimeout(()=>{e.textContent=t,e.style.background="linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},5e3)}catch(n){console.error("âŒ ì¿ í‚¤ ë™ê¸°í™” ì‹¤íŒ¨:",n),e.textContent="âŒ ë™ê¸°í™” ì‹¤íŒ¨",e.style.background="linear-gradient(135deg, #f44336 0%, #d32f2f 100%)",setTimeout(()=>{e.textContent=t,e.style.background="linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},3e3)}finally{e.disabled=!1}}),document.getElementById("openSheets").addEventListener("click",async()=>{try{const e=await fetch(`${this.serverUrl}/api/test-sheets`);if(e.ok){const t=await e.json();if(t.result&&t.result.spreadsheetUrl)return void chrome.tabs.create({url:t.result.spreadsheetUrl})}}catch(e){console.log("ì„œë²„ì—ì„œ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:",e)}chrome.storage.sync.get(["spreadsheetUrl"],e=>{if(e.spreadsheetUrl)chrome.tabs.create({url:e.spreadsheetUrl});else{const e="https://docs.google.com/spreadsheets/d/1UkGu6HObPNo6cPojBzhYeFxNVMkTksrsANTuSGKloJA";chrome.tabs.create({url:e})}})}),document.getElementById("testConnection").addEventListener("click",async()=>{await this.testConnection()}),document.getElementById("collectChannel").addEventListener("click",async()=>{await this.collectChannel()}),["useAI","autoAnalyze","autoSave","batchMode","showNotifications"].forEach(e=>{document.getElementById(e).addEventListener("change",t=>{this.debounceTimers[e]&&clearTimeout(this.debounceTimers[e]);const n=t.target;n.style.transform="scale(1.1)",n.style.transition="transform 0.15s ease",setTimeout(()=>{n.style.transform="scale(1)"},150),console.log(`${e} í† ê¸€: ${t.target.checked}`),this.debounceTimers[e]=setTimeout(()=>{this.saveSetting(e,t.target.checked)},200)})})):console.error("âŒ Instagram ì¿ í‚¤ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")}async testConnection(){const e=document.getElementById("testConnection"),t=e.textContent;e.textContent="í…ŒìŠ¤íŠ¸ ì¤‘...",e.disabled=!0;try{const e=await fetch(`${this.serverUrl}/health`),t=await fetch(`${this.serverUrl}/api/test-sheets`);let n="ì—°ê²° í…ŒìŠ¤íŠ¸ ê²°ê³¼:\n";n+=`ì„œë²„: ${e.ok?"âœ…":"âŒ"}\n`,n+="êµ¬ê¸€ ì‹œíŠ¸: "+(t.ok?"âœ…":"âŒ"),this.showNotification(n)}catch(e){this.showNotification("ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: "+e.message)}finally{e.textContent=t,e.disabled=!1}}async collectChannel(){const e=document.getElementById("collectChannel"),t=e.textContent;try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!(t.url.includes("/channel/")||t.url.includes("/@")||t.url.includes("/c/")||t.url.includes("/user/")))return void this.showNotification("âŒ YouTube ì±„ë„ íŽ˜ì´ì§€ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.");e.textContent="ìˆ˜ì§‘ ì¤‘...",e.disabled=!0;const n=await chrome.tabs.sendMessage(t.id,{action:"showChannelCollectModal"});if(!n||!n.success)throw new Error((null==n?void 0:n.error)||"ì±„ë„ ìˆ˜ì§‘ ê¸°ëŠ¥ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");window.close()}catch(n){console.error("ì±„ë„ ìˆ˜ì§‘ ì‹¤íŒ¨:",n),this.showNotification("âŒ ì±„ë„ ìˆ˜ì§‘ ì‹¤íŒ¨: "+n.message),e.textContent="ì‹¤íŒ¨",e.style.background="#f44336",setTimeout(()=>{e.textContent=t,e.style.background="linear-gradient(45deg, #ff6b6b, #ee5a24)",e.disabled=!1},2e3)}}async loadSettings(){try{const e=(await new Promise(e=>{chrome.storage.sync.get(["videosaverSettings"],e)})).videosaverSettings||{};console.log("ðŸ“‹ ë¡œë“œëœ ì„¤ì •:",e);const t=document.getElementById("useAI"),n=document.getElementById("autoAnalyze"),o=document.getElementById("autoSave"),s=document.getElementById("batchMode"),a=document.getElementById("showNotifications");if(!(t&&n&&o&&s&&a))return void console.warn("âš ï¸ DOM ìš”ì†Œê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•ŠìŒ");t.checked=void 0===e.useAI||e.useAI,n.checked=void 0!==e.autoAnalysis&&e.autoAnalysis,o.checked=void 0===e.autoSave||e.autoSave,s.checked=void 0!==e.batchMode&&e.batchMode,a.checked=void 0===e.showNotifications||e.showNotifications;const c=document.getElementById("settingsContainer");c&&(c.style.opacity="1"),console.log("âœ… UI ë°˜ì˜ ì™„ë£Œ")}catch(e){console.error("âŒ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:",e);const t=document.getElementById("settingsContainer");t&&(t.style.opacity="1")}}async saveSetting(e,t){try{console.log(`ðŸ’¾ ì„¤ì • ì €ìž¥ ì‹œìž‘: ${e} = ${t}`);const n=(await new Promise(e=>{chrome.storage.sync.get(["videosaverSettings"],e)})).videosaverSettings||{};console.log("ðŸ“‹ í˜„ìž¬ ì €ìž¥ëœ ì„¤ì •:",n);let o=e;"autoAnalyze"===e&&(o="autoAnalysis");const s={...n,[o]:t};console.log("ðŸ”„ ì—…ë°ì´íŠ¸ë  ì„¤ì •:",s),await new Promise(e=>{chrome.storage.sync.set({videosaverSettings:s},e)}),console.log(`âœ… ì„¤ì • ì €ìž¥ ì™„ë£Œ: ${o} = ${t}`),this.showQuickFeedback(o)}catch(e){console.error("âŒ ì„¤ì • ì €ìž¥ ì‹¤íŒ¨:",e),this.showNotification("âŒ ì„¤ì • ì €ìž¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤")}}showQuickFeedback(e){let t=e;"autoAnalysis"===e&&(t="autoAnalyze");const n=document.getElementById(t);if(n&&n.parentElement){const e=document.createElement("span");if(e.textContent="âœ“",e.style.cssText="\n        color: #4caf50;\n        font-weight: bold;\n        margin-left: 5px;\n        animation: fadeOut 1s ease-out forwards;\n      ",!document.getElementById("feedback-animation")){const e=document.createElement("style");e.id="feedback-animation",e.textContent="\n          @keyframes fadeOut {\n            0% { opacity: 1; }\n            100% { opacity: 0; }\n          }\n        ",document.head.appendChild(e)}n.parentElement.appendChild(e),setTimeout(()=>{e.parentElement&&e.parentElement.removeChild(e)},1e3)}}showNotification(e){const t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      top: 10px;\n      left: 10px;\n      right: 10px;\n      background: #333;\n      color: white;\n      padding: 10px;\n      border-radius: 5px;\n      z-index: 1000;\n      font-size: 12px;\n      white-space: pre-line;\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{document.body.removeChild(t)},3e3)}}document.addEventListener("DOMContentLoaded",()=>{new e})})();